<!doctype html>
<html lang="zh-CN">
  <head>
    <title>docker 使用规则 // 为吾优</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.55.5" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="fanjinlong" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://blog.v5u.win/css/main.min.59023e5fd38d6ecb0e1dfbb295077c3c67e00e3b9eb3feaf34b5a5e6b332897a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="docker 使用规则"/>
<meta name="twitter:description" content="硬件/操作系统 要求 Docker支持以下的CentOS版本：
 CentOS 7 (64-bit) CentOS 6.5 (64-bit) 或更高的版本  前提条件 目前，CentOS 仅发行版本中的内核支持 Docker。
Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。
Docker 运行在 CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。
### docker 的组件结构
Docker 由镜像(Image)、容器(Container)、仓库(Repository) 三部分组成。
docker-machine, docker, docker-compose (docker环境)
docker container 容器(运行实例)
docker image 镜像(安装实例)
Dockerfile(用于生成image)
### docker配置&#43;使用
预先安装docker的相关库
 brew install docker docker-compose docker-machine  #### 启动docker-machine
To have launchd start docker-machine now and restart at login: brew services start docker-machine"/>

    <meta property="og:title" content="docker 使用规则" />
<meta property="og:description" content="硬件/操作系统 要求 Docker支持以下的CentOS版本：
 CentOS 7 (64-bit) CentOS 6.5 (64-bit) 或更高的版本  前提条件 目前，CentOS 仅发行版本中的内核支持 Docker。
Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。
Docker 运行在 CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。
### docker 的组件结构
Docker 由镜像(Image)、容器(Container)、仓库(Repository) 三部分组成。
docker-machine, docker, docker-compose (docker环境)
docker container 容器(运行实例)
docker image 镜像(安装实例)
Dockerfile(用于生成image)
### docker配置&#43;使用
预先安装docker的相关库
 brew install docker docker-compose docker-machine  #### 启动docker-machine
To have launchd start docker-machine now and restart at login: brew services start docker-machine" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.v5u.win/post/system-docker/" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://blog.v5u.win"><img class="app-header-avatar" src="/avatar.jpg" alt="fanjinlong" /></a>
      <h1>为吾优</h1>
      <p>愿我走在通往幸福的路上</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/jinyuyoulong"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">docker 使用规则</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Jan 1, 0001
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          3 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://blog.v5u.win/tags/docker/">docker</a></div></div>
    </header>
    <div class="post-content">
      

<h2 id="硬件-操作系统-要求">硬件/操作系统 要求</h2>

<p>Docker支持以下的CentOS版本：</p>

<ul>
<li>CentOS 7 (64-bit)</li>
<li>CentOS 6.5 (64-bit) 或更高的版本</li>
</ul>

<hr />

<h2 id="前提条件">前提条件</h2>

<p>目前，CentOS 仅发行版本中的内核支持 Docker。</p>

<p>Docker 运行在 CentOS 7 上，要求系统为64位、系统内核版本为 3.10 以上。</p>

<p>Docker 运行在 CentOS-6.5 或更高的版本的 CentOS 上，要求系统为64位、系统内核版本为 2.6.32-431 或者更高版本。</p>

<p>### docker 的组件结构</p>

<p>Docker 由镜像(Image)、容器(Container)、仓库(Repository) 三部分组成。</p>

<p>docker-machine, docker, docker-compose (docker环境)</p>

<p>docker container 容器(运行实例)</p>

<p>docker image 镜像(安装实例)</p>

<p>Dockerfile(用于生成image)</p>

<p>### docker配置+使用</p>

<p>预先安装docker的相关库</p>

<pre><code>  brew install 
  docker
  docker-compose
  docker-machine
</code></pre>

<p>#### 启动docker-machine</p>

<p>To have launchd start docker-machine now and restart at login:
   <code>brew services start docker-machine</code></p>

<p>Or, if you don&rsquo;t want/need a background service you can just run:
  <code>docker-machine start</code></p>

<p>### docker从创建到启动步骤</p>

<hr />

<ol>
<li><p>docker-machine ls  //检查docker-machine 是否启动了,如果查看的URL为空，则启动docker-machine</p></li>

<li><p>docker-machine start 或 docker-machine create default // 启动或创建docker虚拟主机。每一次启动都要重新创建，默认为 default。</p></li>

<li><p>docker-machine env //配置docker 虚拟主机环境变量</p></li>

<li><p>eval $(docker-machine env) // 使default环境变量生效</p></li>
</ol>

<hr />

<p>docker操作
  5. docker image pull ubuntu // 拉取镜像库</p>

<ol>
<li><p>docker image ls // 查看 已经安装的 image 镜像</p></li>

<li><p>docker container run ubuntu //命令会从 image 文件，生成一个正在运行的容器实例。</p></li>

<li><p>docker exec -it [容器ID] bash //进入已运行的容器，进行bash操作</p></li>
</ol>

<p>### docker 使用规则</p>

<p>镜像源：<a href="https://www.docker-cn.com/registry-mirror">https://www.docker-cn.com/registry-mirror</a>
  在docker或网易蜂巢的镜像库中找到需要的image
  docker pull hub.c.163.com/library/mysql:latest
  docker images
  //启动容器,端口映射8888:8080
  docker run -b -p 8888:8080 hub.c.163.com/library/mysql</p>

<p><code>docker container run hello-world</code></p>

<p>输出这段提示以后，<code>hello world</code>就会停止运行，容器自动终止。</p>

<p>有些容器不会自动终止，因为提供的是服务。比如，安装运行 Ubuntu 的 image，就可以在命令行体验 Ubuntu 系统。</p>

<p><code>docker container run -it ubuntu bash</code></p>

<p>### 编写 Dockerfile 文件生成image
  1. 新建 .dockerignore 文件
     写入要忽略的目录/文件</p>

<pre><code>  .git
  node_modules
  npm-debug.log
</code></pre>

<ol>
<li>新建文本文件Dockerfile</li>
</ol>

<p>写入环境配置</p>

<pre><code class="language-dockerfile">  FROM node:8.4 //该 image 文件继承官方的 node image，冒号表示标签，这里标签是8.4，即8.4版本的 node。
  COPY . /app	//将当前目录下的所有文件（除了.dockerignore排除的路径），都拷贝进入 image 文件的/app目录。
  WORKDIR /app	//指定接下来的工作路径为/app。
  RUN npm install --registry=https://registry.npm.taobao.org	//在/app目录下，运行npm install命令安装依赖。注意，安装后所有的依赖，都将打包进入 image 文件。
  EXPOSE 3000	//将容器 3000 端口暴露出来， 允许外部连接这个端口。
  CMD node demos/01.js	//容器启动后自动执行node demos/01.js。
</code></pre>

<ol>
<li>创建 image 文件</li>
</ol>

<p><code>docker image build -t koa-demo .</code> 或<code>docker image build -t koa-demo:0.0.1 .</code></p>

<ol>
<li>生成容器</li>
</ol>

<p><code>docker container run -p 8000:3000 -it koa-demo /bin/bash</code></p>

<p>### 发布 image 文件</p>

<p>去 hub.docker.com 或 cloud.docker.com 注册一个账户.
  1. docker login
  2. 为本地的 image 标注用户名和版本。
  3. 重新构建一下 image 文件。
  4. 发布 image 文件。
  5. 发布成功以后，登录 hub.docker.com，查看已经发布的 image 文件。</p>

<p>### 其他docker命令</p>

<pre><code>  docker-machine env // 查看环境变量：IP
  docker ps //查看运行的docker
  netstat -na|grep 8888 // 查看端口监听情况
  docker exec -it [容器ID] bash //进入容器，进行bash操作 -it：这是两个参数，一个是 -i 表示交互式操作，一个是 -t 为终端。
  docker run -ti -d --name my-nginx -p 8088:80 docker.io/nginx // 端口映射
  docker rm containerId // 删除 容器文件
  docker rmi imageId // 删除 image文件
  docker stop 1f // 停止运行的容器
  docker start :启动一个或多个已经被停止的容器
  docker stop :停止一个运行中的容器
  docker restart :重启容器
  docker container kill [containID] // 手动终止 运行的 容器
  docker container ls // 列出本机正在运行的容器
  docker container ls --all //列出本机所有容器，包括终止运行的容器
</code></pre>

<p>docker-machine create default // 创建docker虚拟主机，每一次启动都要重新创建，默认创建环境名为 default。如果报错，boot2docker.iso 无法下载可以在GitHub上单独下载后放到 /Users/$username/.docker/machine/cache/ 下</p>

<p>在容器的命令行，按下 Ctrl + c 停止 Node 进程，然后按下 Ctrl + d （或者输入 exit）退出容器。</p>

<p>#### 一些使用原则</p>

<ol>
<li><p>*在创建 Docker Image 的时候使用 <strong>-t</strong> 参数对 Image 打上 Tag*</p></li>

<li><p><em>不要在 Dockerfile 中进行端口映射</em></p></li>
</ol>

<p>如果 Image 的使用者关心 Container 应该将自己的什么端口和 host 的端口进行映射，那就会显式地在创建 Container 的时候使用 <strong>-p</strong> 参数进行设置，否则，Docker 会自动给 Container 分配一个 host 上的端口进行映射。</p>

<ol>
<li>在使用 <strong>CMD</strong> 和 <strong>ENTRYPOINT</strong> 指示的时候使用数组传入参数 <code>CMD [&quot;/bin/echo&quot;]</code></li>
<li>**CMD **和 <strong>ENTRYPOINT</strong> 最好配合使用</li>
</ol>

<p><strong>注意</strong></p>

<p>docker是运行在Linux上的，在Windows/Mac中运行docker，实际上还是在Windows/Mac下先安装了一个Linux环境，然后在这个系统中运行的docker。也就是说，服务中使用的localhost指的是这个Linux环境的地址，而不是我们的宿主环境Windows/Mac。我们可以通过命令：<code>docker-machine ip default</code></p>

<p><strong>找到这个Linux的ip地址，一般情况下这个地址是192.168.99.100，然后在 Windows/Mac 的浏览器中，输入这个地址，加上服务的端口即可启用了。</strong> <code>http://192.168.99.100:8080</code></p>

<p>### docker-compose 编排项目</p>

<p>docker-compose build  //编排 image</p>

<p>docker-compose run my-gin //创建并启动容器</p>

<p>docker-compose.yml    //配置文件</p>

<pre><code class="language-yaml">  version: '3'
  services:

    my-gin:
      build: .
      image: my-gin:v5
      ports:
       - &quot;7070:7070&quot;
      container_name: goweb
      hostname: web
</code></pre>

<p><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html">Docker 入门教程</a></p>

<p><a href="http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html">Docker 微服务教程</a></p>

<p><a href="https://studygolang.com/articles/4219">Dockerfile 最佳实践</a></p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
